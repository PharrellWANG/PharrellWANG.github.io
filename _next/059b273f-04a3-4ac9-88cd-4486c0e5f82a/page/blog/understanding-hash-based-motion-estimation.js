module.exports=__NEXT_REGISTER_PAGE("/blog/understanding-hash-based-motion-estimation",function(){var e=webpackJsonp([6],{20:function(e,t,a){e.exports=a(36)},21:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=a(31);Object.defineProperty(t,"default",{enumerable:true,get:function e(){return l(n).default}});function l(e){return e&&e.__esModule?e:{default:e}}},31:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.styles=void 0;var n=a(2);var l=E(n);var o=a(10);var r=E(o);var i=a(3);var s=E(i);var c=a(0);var d=E(c);var u=a(1);var h=E(u);var p=a(11);var m=E(p);var f=a(9);var v=E(f);var g=a(15);function E(e){return e&&e.__esModule?e:{default:e}}var b=t.styles=function e(t){return{root:{display:"block",margin:0},display4:t.typography.display4,display3:t.typography.display3,display2:t.typography.display2,display1:t.typography.display1,headline:t.typography.headline,title:t.typography.title,subheading:t.typography.subheading,body2:t.typography.body2,body1:t.typography.body1,caption:t.typography.caption,button:t.typography.button,alignLeft:{textAlign:"left"},alignCenter:{textAlign:"center"},alignRight:{textAlign:"right"},alignJustify:{textAlign:"justify"},noWrap:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},gutterBottom:{marginBottom:"0.35em"},paragraph:{marginBottom:2*t.spacing.unit},colorInherit:{color:"inherit"},colorPrimary:{color:t.palette.primary.main},colorSecondary:{color:t.palette.secondary.main},colorTextSecondary:{color:t.palette.text.secondary},colorError:{color:t.palette.error.main}}};function y(e){var t;var a=e.align,n=e.classes,o=e.className,i=e.component,c=e.color,u=e.gutterBottom,h=e.headlineMapping,p=e.noWrap,f=e.paragraph,v=e.variant,E=(0,s.default)(e,["align","classes","className","component","color","gutterBottom","headlineMapping","noWrap","paragraph","variant"]);var b=(0,m.default)(n.root,n[v],(t={},(0,r.default)(t,n["color"+(0,g.capitalize)(c)],"default"!==c),(0,r.default)(t,n.noWrap,p),(0,r.default)(t,n.gutterBottom,u),(0,r.default)(t,n.paragraph,f),(0,r.default)(t,n["align"+(0,g.capitalize)(a)],"inherit"!==a),t),o);var y=i||(f?"p":h[v])||"span";return d.default.createElement(y,(0,l.default)({className:b},E))}y.propTypes={};y.defaultProps={align:"inherit",color:"default",gutterBottom:false,headlineMapping:{display4:"h1",display3:"h1",display2:"h1",display1:"h1",headline:"h1",title:"h2",subheading:"h3",body2:"aside",body1:"p"},noWrap:false,paragraph:false,variant:"body1"};t.default=(0,v.default)(b,{name:"MuiTypography"})(y)},35:function(e,t,a){"use strict";var n=a(12);var l=a.n(n);var o=a(0);var r=a.n(o);var i=a(20);var s=a.n(i);var c=a(37);var d=a.n(c);var u=s()(new(a(20).SameLoopPromise)(function(e,t){var n=29;try{var l=a(n);return e(l)}catch(e){}a.e(0).then(function(n){try{var l=a(29);l.__webpackChunkName="react_syntax_highlighter_5e0c44cc80beffdff473f2e6ef5cb15c";e(l)}catch(e){t(e)}}.bind(null,a)).catch(a.oe)}),{loading:function e(){return r.a.createElement("div",null)}});var h={padding:8,paddingBottom:20,fontSize:"100%",borderRadius:5,backgroundColor:"#eeeeee",lineHeight:1.1};t["a"]=function(e){var t=e.language,a=e.children;return r.a.createElement("div",{className:"jsx-1371294351 jsx-1371294351 code"},r.a.createElement(u,{language:t,style:d.a,customStyle:h},a.trim()),r.a.createElement(l.a,{styleId:"1371294351",css:".code.jsx-1371294351{margin:15px 0;}"}))}},36:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.SameLoopPromise=void 0;var n=a(58);var l=k(n);var o=a(17);var r=k(o);var i=a(6);var s=k(i);var c=a(4);var d=k(c);var u=a(5);var h=k(u);var p=a(7);var m=k(p);var f=a(8);var v=k(f);var g=a(40);var E=k(g);t.default=w;t.registerChunk=C;t.flushChunks=_;var b=a(0);var y=k(b);var x=a(27);function k(e){return e&&e.__esModule?e:{default:e}}var j=new E.default;function w(e,t){var a=void 0;var n=void 0;if(e instanceof T){a=e;n=t||{}}else{if(!e.modules||!e.render){var l="`next/dynamic` options should contain `modules` and `render` fields";throw new Error(l)}if(t){var o="Add additional `next/dynamic` options to the first argument containing the `modules` and `render` fields";throw new Error(o)}n=e}return function(e){(0,v.default)(t,e);function t(){var e;(0,d.default)(this,t);for(var a=arguments.length,l=Array(a),o=0;o<a;o++)l[o]=arguments[o];var r=(0,m.default)(this,(e=t.__proto__||(0,s.default)(t)).call.apply(e,[this].concat(l)));r.LoadingComponent=n.loading?n.loading:function(){return y.default.createElement("p",null,"loading...")};r.ssr=false!==n.ssr||n.ssr;r.state={AsyncComponent:null,asyncElement:null};r.isServer="undefined"===typeof window;r.loadBundleAgain=null;r.loadingBundle=false;r.ssr&&r.load();return r}(0,h.default)(t,[{key:"load",value:function e(){a?this.loadComponent():this.loadBundle(this.props)}},{key:"loadComponent",value:function e(){var n=this;a.then(function(e){var a=e.default||e;var l=(0,x.getDisplayName)(a);l&&(t.displayName="DynamicComponent for "+l);if(n.mounted)n.setState({AsyncComponent:a});else{n.isServer&&C(e.__webpackChunkName);n.state.AsyncComponent=a}})}},{key:"loadBundle",value:function e(a){var l=this;this.loadBundleAgain=null;this.loadingBundle=true;var o=n.modules(a);var i=(0,r.default)(o);var s=i.length;var c={};var d=function e(){if(l.loadBundleAgain){l.loadBundle(l.loadBundleAgain);return}l.loadingBundle=false;t.displayName="DynamicBundle";var o=n.render(a,c);l.mounted?l.setState({asyncElement:o}):l.state.asyncElement=o};var u=function e(t){var a=o[t];a.then(function(e){var a=e.default||e;l.isServer&&C(e.__webpackChunkName);c[t]=a;s--;0===s&&d()})};i.forEach(u)}},{key:"componentDidMount",value:function e(){this.mounted=true;this.ssr||this.load()}},{key:"componentWillReceiveProps",value:function e(t){if(a)return;this.setState({asyncElement:null});if(this.loadingBundle){this.loadBundleAgain=t;return}this.loadBundle(t)}},{key:"render",value:function e(){var t=this.state,a=t.AsyncComponent,n=t.asyncElement;var l=this.LoadingComponent;if(n)return n;if(a)return y.default.createElement(a,this.props);return y.default.createElement(l,this.props)}}]);return t}(y.default.Component)}function C(e){j.add(e)}function _(){var e=(0,l.default)(j);j.clear();return e}var T=t.SameLoopPromise=function(){(0,h.default)(e,null,[{key:"resolve",value:function t(a){var n=new e(function(e){return e(a)});return n}}]);function e(t){(0,d.default)(this,e);this.onResultCallbacks=[];this.onErrorCallbacks=[];this.cb=t}(0,h.default)(e,[{key:"setResult",value:function e(t){this.gotResult=true;this.result=t;this.onResultCallbacks.forEach(function(e){return e(t)});this.onResultCallbacks=[]}},{key:"setError",value:function e(t){this.gotError=true;this.error=t;this.onErrorCallbacks.forEach(function(e){return e(t)});this.onErrorCallbacks=[]}},{key:"then",value:function t(a,n){var l=this;this.runIfNeeded();var o=new e;var r=function e(){n?o.setResult(n(l.error)):o.setError(l.error)};var i=function e(){o.setResult(a(l.result))};if(this.gotResult){i();return o}if(this.gotError){r();return o}this.onResultCallbacks.push(i);this.onErrorCallbacks.push(r);return o}},{key:"catch",value:function t(a){var n=this;this.runIfNeeded();var l=new e;var o=function e(){l.setResult(a(n.error))};var r=function e(){l.setResult(n.result)};if(this.gotResult){r();return l}if(this.gotError){o();return l}this.onErrorCallbacks.push(o);this.onResultCallbacks.push(r);return l}},{key:"runIfNeeded",value:function e(){var t=this;if(!this.cb)return;if(this.ran)return;this.ran=true;this.cb(function(e){return t.setResult(e)},function(e){return t.setError(e)})}}]);return e}()},37:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default={hljs:{display:"block",background:"white",padding:"0.5em",color:"#333333",overflowX:"auto"},"hljs-comment":{color:"#969896"},"hljs-meta":{color:"#969896"},"hljs-string":{color:"#df5000"},"hljs-variable":{color:"#df5000"},"hljs-template-variable":{color:"#df5000"},"hljs-strong":{color:"#df5000"},"hljs-emphasis":{color:"#df5000"},"hljs-quote":{color:"#df5000"},"hljs-keyword":{color:"#a71d5d"},"hljs-selector-tag":{color:"#a71d5d"},"hljs-type":{color:"#a71d5d"},"hljs-literal":{color:"#0086b3"},"hljs-symbol":{color:"#0086b3"},"hljs-bullet":{color:"#0086b3"},"hljs-attribute":{color:"#0086b3"},"hljs-section":{color:"#63a35c"},"hljs-name":{color:"#63a35c"},"hljs-tag":{color:"#333333"},"hljs-title":{color:"#795da3"},"hljs-attr":{color:"#795da3"},"hljs-selector-id":{color:"#795da3"},"hljs-selector-class":{color:"#795da3"},"hljs-selector-attr":{color:"#795da3"},"hljs-selector-pseudo":{color:"#795da3"},"hljs-addition":{color:"#55a532",backgroundColor:"#eaffea"},"hljs-deletion":{color:"#bd2c00",backgroundColor:"#ffecec"},"hljs-link":{textDecoration:"underline"}}},473:function(e,t,a){e.exports=a(474)},474:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=a(12);var l=a.n(n);var o=a(0);var r=a.n(o);var i=a(32);var s=a.n(i);var c=a(33);var d=a(81);var u=a(35);var h=function e(t){var a=t.noteStrToRender;return r.a.createElement("div",{className:"jsx-2588419384 jsx-2588419384"},r.a.createElement("div",{className:"jsx-2588419384 jsx-2588419384 widgets_div"},r.a.createElement("div",{className:"jsx-2588419384 jsx-2588419384 icon_div"},"Note: "),r.a.createElement("div",{className:"jsx-2588419384 jsx-2588419384 text_div"},a)),r.a.createElement(l.a,{styleId:"2588419384",css:"div.jsx-2588419384{background-color:#e1f5fe;padding:5px 5px 5px 5px;margin:1px 0;color:#01579b;border-radius:5px;}.widgets_div.jsx-2588419384{border-bottom:thin #edf1f2 solid;padding:0.5px 0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.widgets_div.jsx-2588419384 .icon_div.jsx-2588419384{display:inline-block;font-size:15px;font-weight:500;}.text_div.jsx-2588419384{display:inline-block;margin:0.5px 0 0 0;padding:5px 5px 5px 0px;}"}))};var p=h;var m=r.a.createElement("div",{className:"jsx-138357423 jsx-138357423"},r.a.createElement("p",{className:"jsx-138357423 jsx-138357423 no_marginp"},"In HEVC, ",r.a.createElement("ins",{className:"jsx-138357423 jsx-138357423"},"Level 1")," only handles 176x144 resolution at 15 fps, whereas ",r.a.createElement("ins",{className:"jsx-138357423 jsx-138357423"},"level 4.1")," would be capable of 1920x1080 HDTV at 60 fps, and levels in version 1 are defined up to ",r.a.createElement("ins",{className:"jsx-138357423 jsx-138357423"},"level 6.1"),", which is capable of 8192x4320 video resolution at up to 120 fps. ",r.a.createElement("br",{className:"jsx-138357423 jsx-138357423"})),r.a.createElement(l.a,{styleId:"138357423",css:".no_marginp.jsx-138357423{margin:0.5px 0 0 0;font-weight:400;}"}));var f=t["default"]=Object(c["b"])({title:"Understanding Hash-based Motion Estimation",description:"An attempt to explain Hash-based Motion Estimation in VVC.",slug:"understanding-hash-based-motion-estimation",date:"July 10, 2019",GATrackID:"UA-111720492-5"})(s()(c["a"],function(e){return r.a.createElement("div",{className:"jsx-138357423 _markdown_"},r.a.createElement(e.p,null,"The post attempts to explain Hash-based Motion Estimation (HBME). It has been applied in SCC extention of HEVC thus not new. However, HBME is yet another additional coding tool when simply compare VVC and HEVC (if we are not talking about HEVC extension)."),r.a.createElement(e.h2,null,"Motivation"),r.a.createElement(e.p,null,"During the development of HEVC SCC, it is believed that hash-based motion search can overcome some shortcomings of conventional motion estimation [1]."),r.a.createElement(e.ol,null,r.a.createElement(e.li,null,r.a.createElement(e.strong,null,"Find blocks that match better"),": search range of HBME can be full picture instead of a local region. For screen contents, conventional motion search may not work well due to the limited search range. It can provide better long range motion compensation, thus complemental to conventional motion search."),r.a.createElement(e.li,null,r.a.createElement(e.strong,null,"Expedite ME progress"),": in HBME, once a match will be found, the following checks can be early terminated.")),r.a.createElement(e.h2,null,"Hash-based Motion Search"),r.a.createElement(e.p,null,"HBME is only allowed in NEXT profile [1] (Review of profile is available in last section). HBME is applicable to 4x4, 4x8, 8x4, 8x8, 16x16, 32x32 and 64x64 blocks. For inter coding, the HBME is performed before all coding modes. For each reference picture, several hash tables are generated. Each hash table corresponds to a specific block size that is allowed."),r.a.createElement(e.h3,null,"Hash Table Generation"),r.a.createElement(e.blockquote,null,r.a.createElement(e.p,null,"When generating the hash values for different blocks, the CRC (Cyclic Redundancy Check) is used. To understand CRC, please refer to ",r.a.createElement(e.a,{href:"https://github.com/PharrellWANG/crc"},"crc")," repository, in which different CRC algorithm implementations are provided in C++. The code in VTM4.0 for CRC algorithm has been extracted as a lib called ",r.a.createElement(e.code,null,"CrcXVTM4"),".")),r.a.createElement(e.p,null,"To save computation and achieve acceleration, the hash table generation is built as follows [1]:"),r.a.createElement(e.ul,null,r.a.createElement(e.li,null,"For 2x2 block, the block hash value is calculated directly from the original pixels (for YUV 4:2:0, only luma component is utilized). The CRC (Cyclic Redundancy Check) value is used as the hash value."),r.a.createElement(e.li,null,"For 4x4, 8x8, 16x16, 32x32 and 64x64 square blocks, the hash value of the current block is the CRC value calculated from the CRC values of its four sub blocks."),r.a.createElement(e.li,null,"For 4x8 and 8x4 blocks, the hash value of the current block is the CRC value calculated from the CRC values of its two sub 4x4 blocks.")),r.a.createElement(e.p,null,"To avoid the hash conflicts, the structure of inverted index table has been utilized. For example, see the code block below, if a generated ",r.a.createElement(e.code,null,"hashValue")," key causes duplication, the new ",r.a.createElement(e.code,null,"BlockHash")," object corresponding to that key will be pushed back to the vector of ",r.a.createElement(e.code,null,"BlockHash")," objects instead of simply overwrite the old object. The key design is the usage of that ",r.a.createElement(e.code,null,"BlockHash")," vector. When retrieving the ",r.a.createElement(e.code,null,"BlockHash")," object, if a ",r.a.createElement(e.code,null,"hashValue")," key points to a vector of size larger than 1, the correct ",r.a.createElement(e.code,null,"BlockHash")," object can still be located using the ",r.a.createElement(e.code,null,"x")," and ",r.a.createElement(e.code,null,"y")," coordinates."),r.a.createElement(e.p,null,r.a.createElement(u["a"],{language:"cpp"},"\nvoid TComHash::addToTable(uint32_t hashValue, const BlockHash& blockHash)\n{\n  if (m_lookupTable[hashValue] == NULL)\n  {\n    m_lookupTable[hashValue] = new std::vector<BlockHash>;\n    m_lookupTable[hashValue]->push_back(blockHash);\n  }\n  else\n  {\n    m_lookupTable[hashValue]->push_back(blockHash);\n  }\n}\n\nstruct BlockHash\n{\n  short x;\n  short y;\n  uint32_t hashValue2;\n};\n")),r.a.createElement(e.p,null,"To control the length of hash table, some hash values will not be added into the table if their corresponding blocks satisfy the following conditions [1]:"),r.a.createElement(e.ul,null,r.a.createElement(e.li,null,"The pixels in each row (column) are identical."),r.a.createElement(e.li,null,"The horizontal (vertical) position is not integral multiples of block width (height).")),r.a.createElement(e.h3,null,"Early Termination"),r.a.createElement(e.p,null,"For inter coding, the hash-based motion search is performed before all coding modes. To accelerate the encoding process, the other coding modes (except the skip part of ETM_MERGE_SKIP, ETM_AFFINE, ETM_MERGE_TRIANGLE modes) and finer-grained block splitting are skipped if the following conditions are satisfied [1]:"),r.a.createElement(e.ul,null,r.a.createElement(e.li,null,"Current block size is 64x64."),r.a.createElement(e.li,null,"Hash match is found in reference frame."),r.a.createElement(e.li,null,"The QP of reference frame is not larger than that of current frame.")),r.a.createElement(e.p,null,"In addition, for all block sizes that hash search supports, the hash-based motion vector is checked for the start point initialization in the normal integral motion search. If the hash-based motion vector exists, the fractional motion estimation is skipped. In a recent implementation, for each sequence, it is determined if the proposed hash search is applied or not. By doing so, the encoding time for ",r.a.createElement(e.em,null,"camera captured")," contents can be kept similar."),r.a.createElement(e.h2,null,"Review"),r.a.createElement(e.h3,null,"Profile, Level and Tier"),r.a.createElement(e.p,null,"In this section, the concepts of profile, level and tier in standards are reviewed."),r.a.createElement(e.p,null,"Some variation in capabilities of the standard is necessary to support a broad range of applications. This variation is handled by specifying profiles, levels and tiers."),r.a.createElement(e.p,null,"A ",r.a.createElement(e.strong,null,"profile")," defines the set of coding tools which may be used to encode a video sequence into a bitstream. The encoder is not required to use all coding tools available in the profile but may select the coding tools which it considers to be suitable [2]. A set of allowed profiles in VTM4.0 is shown below."),r.a.createElement(e.p,null,r.a.createElement(u["a"],{language:"cpp"},"\n// Profiles defined in VTM4.0\nnamespace Profile{\n  enum Name {\n    NONE = 0, MAIN = 1, MAIN10 = 2, MAINSTILLPICTURE = 3,\n    MAINREXT = 4, HIGHTHROUGHPUTREXT = 5, NEXT = 6 }; }\n")),r.a.createElement(e.p,null,"A ",r.a.createElement(e.strong,null,"level")," defines the degree of capability given a profile. Levels/degrees of capability are defined to establish the picture resolution, frame rate, bit rate, buffering capacity, and other aspects that are matters of degree rather than basic feature sets/coding tools."),r.a.createElement(e.p,null,r.a.createElement(p,{noteStrToRender:m})),r.a.createElement(e.p,null,"In each level, ",r.a.createElement(e.strong,null,"tiers")," are defined based on the bit rates they are capable of handling. Main Tier is mainly used to meet the demand of consumer usage, while High Tier is used to provide adequate quality for professional usage than what would be necessary for consumer applications. Levels and tiers defined in VTM4.0 are shown below."),r.a.createElement(e.p,null,r.a.createElement(u["a"],{language:"cpp"},"\n// Tiers and Levels defined in VTM4.0\nnamespace Level{\n  enum Tier { MAIN = 0, HIGH = 1, };\n  enum Name {\n    NONE     = 0,   LEVEL1   = 30,  LEVEL2   = 60,  LEVEL2_1 = 63,  LEVEL3   = 90,\n    LEVEL3_1 = 93,  LEVEL4   = 120, LEVEL4_1 = 123, LEVEL5   = 150, LEVEL5_1 = 153,\n    LEVEL5_2 = 156, LEVEL6   = 180, LEVEL6_1 = 183, LEVEL6_2 = 186, LEVEL8_5 = 255, }; }\n")),r.a.createElement(e.hr,null),r.a.createElement(e.p,null,"References"),r.a.createElement(e.p,null,r.a.createElement(d["a"],{num:"1",content:"J. Xu, J. Li, K. Zhang, L. Zhang, H. Liu, Y. Wang, P. Zhao, D. Hong, R. Xiong, 'Non-CE8: Hash-based Motion Search', Joint Video Exploration Team (JVET), docs. JVET-M0253, 2019."})),r.a.createElement(e.p,null,r.a.createElement(d["a"],{num:"2",content:"V. Sze, M. Budagavi, and G. J. Sullivan (Editors), High Efficiency Video Coding (HEVC) Algorithms and Architectures (Integrated Circuits and Systems). Dordrecht: Springer, 2014."})))}))},81:function(e,t,a){"use strict";var n=a(12);var l=a.n(n);var o=a(0);var r=a.n(o);var i=a(21);var s=a.n(i);t["a"]=function(e){var t=e.num,a=e.content;return r.a.createElement("div",{className:"jsx-2207567817 jsx-2207567817 indentRow"},r.a.createElement(s.a,{component:"p",gutterBottom:true},"[",t,"]  "),r.a.createElement(s.a,{component:"p",gutterBottom:true},a),r.a.createElement(l.a,{styleId:"2207567817",css:".indentRow.jsx-2207567817{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}"}))}}},[473]);return{page:e.default}});