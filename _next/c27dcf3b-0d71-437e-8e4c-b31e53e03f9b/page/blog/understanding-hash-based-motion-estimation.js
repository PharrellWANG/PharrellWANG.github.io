module.exports=__NEXT_REGISTER_PAGE("/blog/understanding-hash-based-motion-estimation",function(){var e=webpackJsonp([6],{20:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=a(31);Object.defineProperty(t,"default",{enumerable:true,get:function e(){return l(n).default}});function l(e){return e&&e.__esModule?e:{default:e}}},21:function(e,t,a){e.exports=a(36)},26:function(e,t,a){"use strict";var n=a(12);var l=a.n(n);var r=a(0);var o=a.n(r);t["a"]=function(e){var t=e.src,a=e.width,n=void 0===a?"100%":a,r=e.height,i=e.alt,s=e.title;return o.a.createElement("div",{className:"jsx-1221164359 jsx-1221164359 container"},o.a.createElement("img",{src:t,width:n,height:r,alt:i,className:"jsx-1221164359 jsx-1221164359"}),s?o.a.createElement("div",{className:"jsx-1221164359 jsx-1221164359 title"},s):null,o.a.createElement(l.a,{styleId:"1221164359",css:".container.jsx-1221164359{text-align:center;max-width:100%;margin:50px 0;}img.jsx-1221164359{max-width:100%;}.title.jsx-1221164359{color:#888;font-size:13px;line-height:17px;padding:5px 0;}.title.jsx-1221164359 div.jsx-1221164359{margin:0;}"}))}},31:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.styles=void 0;var n=a(2);var l=g(n);var r=a(10);var o=g(r);var i=a(3);var s=g(i);var c=a(0);var d=g(c);var u=a(1);var p=g(u);var m=a(11);var h=g(m);var f=a(9);var E=g(f);var v=a(15);function g(e){return e&&e.__esModule?e:{default:e}}var b=t.styles=function e(t){return{root:{display:"block",margin:0},display4:t.typography.display4,display3:t.typography.display3,display2:t.typography.display2,display1:t.typography.display1,headline:t.typography.headline,title:t.typography.title,subheading:t.typography.subheading,body2:t.typography.body2,body1:t.typography.body1,caption:t.typography.caption,button:t.typography.button,alignLeft:{textAlign:"left"},alignCenter:{textAlign:"center"},alignRight:{textAlign:"right"},alignJustify:{textAlign:"justify"},noWrap:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},gutterBottom:{marginBottom:"0.35em"},paragraph:{marginBottom:2*t.spacing.unit},colorInherit:{color:"inherit"},colorPrimary:{color:t.palette.primary.main},colorSecondary:{color:t.palette.secondary.main},colorTextSecondary:{color:t.palette.text.secondary},colorError:{color:t.palette.error.main}}};function y(e){var t;var a=e.align,n=e.classes,r=e.className,i=e.component,c=e.color,u=e.gutterBottom,p=e.headlineMapping,m=e.noWrap,f=e.paragraph,E=e.variant,g=(0,s.default)(e,["align","classes","className","component","color","gutterBottom","headlineMapping","noWrap","paragraph","variant"]);var b=(0,h.default)(n.root,n[E],(t={},(0,o.default)(t,n["color"+(0,v.capitalize)(c)],"default"!==c),(0,o.default)(t,n.noWrap,m),(0,o.default)(t,n.gutterBottom,u),(0,o.default)(t,n.paragraph,f),(0,o.default)(t,n["align"+(0,v.capitalize)(a)],"inherit"!==a),t),r);var y=i||(f?"p":p[E])||"span";return d.default.createElement(y,(0,l.default)({className:b},g))}y.propTypes={};y.defaultProps={align:"inherit",color:"default",gutterBottom:false,headlineMapping:{display4:"h1",display3:"h1",display2:"h1",display1:"h1",headline:"h1",title:"h2",subheading:"h3",body2:"aside",body1:"p"},noWrap:false,paragraph:false,variant:"body1"};t.default=(0,E.default)(b,{name:"MuiTypography"})(y)},35:function(e,t,a){"use strict";var n=a(12);var l=a.n(n);var r=a(0);var o=a.n(r);var i=a(21);var s=a.n(i);var c=a(37);var d=a.n(c);var u=s()(new(a(21).SameLoopPromise)(function(e,t){var n=30;try{var l=a(n);return e(l)}catch(e){}a.e(0).then(function(n){try{var l=a(30);l.__webpackChunkName="react_syntax_highlighter_5e0c44cc80beffdff473f2e6ef5cb15c";e(l)}catch(e){t(e)}}.bind(null,a)).catch(a.oe)}),{loading:function e(){return o.a.createElement("div",null)}});var p={padding:8,paddingBottom:20,fontSize:"100%",borderRadius:5,backgroundColor:"#eeeeee",lineHeight:1.1};t["a"]=function(e){var t=e.language,a=e.children;return o.a.createElement("div",{className:"jsx-1371294351 jsx-1371294351 code"},o.a.createElement(u,{language:t,style:d.a,customStyle:p},a.trim()),o.a.createElement(l.a,{styleId:"1371294351",css:".code.jsx-1371294351{margin:15px 0;}"}))}},36:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.SameLoopPromise=void 0;var n=a(58);var l=j(n);var r=a(17);var o=j(r);var i=a(6);var s=j(i);var c=a(4);var d=j(c);var u=a(5);var p=j(u);var m=a(7);var h=j(m);var f=a(8);var E=j(f);var v=a(40);var g=j(v);t.default=w;t.registerChunk=k;t.flushChunks=M;var b=a(0);var y=j(b);var x=a(28);function j(e){return e&&e.__esModule?e:{default:e}}var _=new g.default;function w(e,t){var a=void 0;var n=void 0;if(e instanceof T){a=e;n=t||{}}else{if(!e.modules||!e.render){var l="`next/dynamic` options should contain `modules` and `render` fields";throw new Error(l)}if(t){var r="Add additional `next/dynamic` options to the first argument containing the `modules` and `render` fields";throw new Error(r)}n=e}return function(e){(0,E.default)(t,e);function t(){var e;(0,d.default)(this,t);for(var a=arguments.length,l=Array(a),r=0;r<a;r++)l[r]=arguments[r];var o=(0,h.default)(this,(e=t.__proto__||(0,s.default)(t)).call.apply(e,[this].concat(l)));o.LoadingComponent=n.loading?n.loading:function(){return y.default.createElement("p",null,"loading...")};o.ssr=false!==n.ssr||n.ssr;o.state={AsyncComponent:null,asyncElement:null};o.isServer="undefined"===typeof window;o.loadBundleAgain=null;o.loadingBundle=false;o.ssr&&o.load();return o}(0,p.default)(t,[{key:"load",value:function e(){a?this.loadComponent():this.loadBundle(this.props)}},{key:"loadComponent",value:function e(){var n=this;a.then(function(e){var a=e.default||e;var l=(0,x.getDisplayName)(a);l&&(t.displayName="DynamicComponent for "+l);if(n.mounted)n.setState({AsyncComponent:a});else{n.isServer&&k(e.__webpackChunkName);n.state.AsyncComponent=a}})}},{key:"loadBundle",value:function e(a){var l=this;this.loadBundleAgain=null;this.loadingBundle=true;var r=n.modules(a);var i=(0,o.default)(r);var s=i.length;var c={};var d=function e(){if(l.loadBundleAgain){l.loadBundle(l.loadBundleAgain);return}l.loadingBundle=false;t.displayName="DynamicBundle";var r=n.render(a,c);l.mounted?l.setState({asyncElement:r}):l.state.asyncElement=r};var u=function e(t){var a=r[t];a.then(function(e){var a=e.default||e;l.isServer&&k(e.__webpackChunkName);c[t]=a;s--;0===s&&d()})};i.forEach(u)}},{key:"componentDidMount",value:function e(){this.mounted=true;this.ssr||this.load()}},{key:"componentWillReceiveProps",value:function e(t){if(a)return;this.setState({asyncElement:null});if(this.loadingBundle){this.loadBundleAgain=t;return}this.loadBundle(t)}},{key:"render",value:function e(){var t=this.state,a=t.AsyncComponent,n=t.asyncElement;var l=this.LoadingComponent;if(n)return n;if(a)return y.default.createElement(a,this.props);return y.default.createElement(l,this.props)}}]);return t}(y.default.Component)}function k(e){_.add(e)}function M(){var e=(0,l.default)(_);_.clear();return e}var T=t.SameLoopPromise=function(){(0,p.default)(e,null,[{key:"resolve",value:function t(a){var n=new e(function(e){return e(a)});return n}}]);function e(t){(0,d.default)(this,e);this.onResultCallbacks=[];this.onErrorCallbacks=[];this.cb=t}(0,p.default)(e,[{key:"setResult",value:function e(t){this.gotResult=true;this.result=t;this.onResultCallbacks.forEach(function(e){return e(t)});this.onResultCallbacks=[]}},{key:"setError",value:function e(t){this.gotError=true;this.error=t;this.onErrorCallbacks.forEach(function(e){return e(t)});this.onErrorCallbacks=[]}},{key:"then",value:function t(a,n){var l=this;this.runIfNeeded();var r=new e;var o=function e(){n?r.setResult(n(l.error)):r.setError(l.error)};var i=function e(){r.setResult(a(l.result))};if(this.gotResult){i();return r}if(this.gotError){o();return r}this.onResultCallbacks.push(i);this.onErrorCallbacks.push(o);return r}},{key:"catch",value:function t(a){var n=this;this.runIfNeeded();var l=new e;var r=function e(){l.setResult(a(n.error))};var o=function e(){l.setResult(n.result)};if(this.gotResult){o();return l}if(this.gotError){r();return l}this.onErrorCallbacks.push(r);this.onResultCallbacks.push(o);return l}},{key:"runIfNeeded",value:function e(){var t=this;if(!this.cb)return;if(this.ran)return;this.ran=true;this.cb(function(e){return t.setResult(e)},function(e){return t.setError(e)})}}]);return e}()},37:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default={hljs:{display:"block",background:"white",padding:"0.5em",color:"#333333",overflowX:"auto"},"hljs-comment":{color:"#969896"},"hljs-meta":{color:"#969896"},"hljs-string":{color:"#df5000"},"hljs-variable":{color:"#df5000"},"hljs-template-variable":{color:"#df5000"},"hljs-strong":{color:"#df5000"},"hljs-emphasis":{color:"#df5000"},"hljs-quote":{color:"#df5000"},"hljs-keyword":{color:"#a71d5d"},"hljs-selector-tag":{color:"#a71d5d"},"hljs-type":{color:"#a71d5d"},"hljs-literal":{color:"#0086b3"},"hljs-symbol":{color:"#0086b3"},"hljs-bullet":{color:"#0086b3"},"hljs-attribute":{color:"#0086b3"},"hljs-section":{color:"#63a35c"},"hljs-name":{color:"#63a35c"},"hljs-tag":{color:"#333333"},"hljs-title":{color:"#795da3"},"hljs-attr":{color:"#795da3"},"hljs-selector-id":{color:"#795da3"},"hljs-selector-class":{color:"#795da3"},"hljs-selector-attr":{color:"#795da3"},"hljs-selector-pseudo":{color:"#795da3"},"hljs-addition":{color:"#55a532",backgroundColor:"#eaffea"},"hljs-deletion":{color:"#bd2c00",backgroundColor:"#ffecec"},"hljs-link":{textDecoration:"underline"}}},472:function(e,t,a){e.exports=a(473)},473:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=a(12);var l=a.n(n);var r=a(0);var o=a.n(r);var i=a(33);var s=a.n(i);var c=a(34);var d=a(81);var u=a(35);var p=function e(t){var a=t.noteStrToRender;return o.a.createElement("div",{className:"jsx-2588419384 jsx-2588419384"},o.a.createElement("div",{className:"jsx-2588419384 jsx-2588419384 widgets_div"},o.a.createElement("div",{className:"jsx-2588419384 jsx-2588419384 icon_div"},"Note: "),o.a.createElement("div",{className:"jsx-2588419384 jsx-2588419384 text_div"},a)),o.a.createElement(l.a,{styleId:"2588419384",css:"div.jsx-2588419384{background-color:#e1f5fe;padding:5px 5px 5px 5px;margin:1px 0;color:#01579b;border-radius:5px;}.widgets_div.jsx-2588419384{border-bottom:thin #edf1f2 solid;padding:0.5px 0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.widgets_div.jsx-2588419384 .icon_div.jsx-2588419384{display:inline-block;font-size:15px;font-weight:500;}.text_div.jsx-2588419384{display:inline-block;margin:0.5px 0 0 0;padding:5px 5px 5px 0px;}"}))};var m=p;var h=a(26);var f=o.a.createElement("div",{className:"jsx-138357423 jsx-138357423"},o.a.createElement("p",{className:"jsx-138357423 jsx-138357423 no_marginp"},"In HEVC, ",o.a.createElement("ins",{className:"jsx-138357423 jsx-138357423"},"Level 1")," only handles 176x144 resolution at 15 fps, whereas ",o.a.createElement("ins",{className:"jsx-138357423 jsx-138357423"},"level 4.1")," would be capable of 1920x1080 HDTV at 60 fps, and levels in version 1 are defined up to ",o.a.createElement("ins",{className:"jsx-138357423 jsx-138357423"},"level 6.1"),", which is capable of 8192x4320 video resolution at up to 120 fps. ",o.a.createElement("br",{className:"jsx-138357423 jsx-138357423"})),o.a.createElement(l.a,{styleId:"138357423",css:".no_marginp.jsx-138357423{margin:0.5px 0 0 0;font-weight:400;}"}));var E=t["default"]=Object(c["b"])({title:"Understanding Hash-based Motion Estimation",description:"An attempt to explain Hash-based Motion Estimation in VVC.",slug:"understanding-hash-based-motion-estimation",date:"July 4, 2019",GATrackID:"UA-111720492-5"})(s()(c["a"],function(e){return o.a.createElement("div",{className:"jsx-138357423 _markdown_"},o.a.createElement(e.p,null,"The post attempts to explain Hash-based Motion Estimation (HBME), which is a new technique in VVC compared with HEVC."),o.a.createElement(e.h2,null,"Motivation"),o.a.createElement(e.p,null,"During the development of HEVC SCC, it is believed that hash-based motion search can overcome some shortcomings of conventional motion estimation. (But... has it been proposed for SCC previously? Readers who are experienced with SCC may share insights in comment section.)"),o.a.createElement(e.ol,null,o.a.createElement(e.li,null,o.a.createElement(e.strong,null,"Find blocks that match better"),": search range of HBME can be full picture instead of a local region. For screen contents, conventional motion search may not work well due to the limited search range."),o.a.createElement(e.li,null,o.a.createElement(e.strong,null,"Expedite ME progress"),": in HBME, once a match will be found, the following checks can be early terminated.")),o.a.createElement(e.h2,null,"Main Idea"),o.a.createElement(e.p,null,"pha_todo"),o.a.createElement(e.h2,null,"Implementation"),o.a.createElement(e.p,null,"The Implementation for HBME in VTM4.0 is discussed in this section."),o.a.createElement(e.p,null,"HBME can be either enabled or disabled via ",o.a.createElement(e.code,null,"HashME")," flag from command line."),o.a.createElement(e.p,null,o.a.createElement(u["a"],{language:"cpp"},'\npo::Options opts;\nopts.addOptions()\n// ...\n#if JVET_M0253_HASH_ME\n  ("HashME", m_HashME, false, "Enable hash motion estimation (0:off, 1:on)");\n#endif\n// ...\n')),o.a.createElement(e.p,null,o.a.createElement(e.code,null,"m_HashME")," is a protected data member in ",o.a.createElement(e.code,null,"class EncAppCfg")," publicly inherited by ",o.a.createElement(e.code,null,"class EncApp"),". ",o.a.createElement(e.code,null,"class EncApp")," has a private member of type ",o.a.createElement(e.code,null,"class EncLib"),", which has a protected member ",o.a.createElement(e.code,null,"m_HashME")," publicly inherited from ",o.a.createElement(e.code,null,"class EncCfg"),". Hence both ",o.a.createElement(e.code,null,"class EncApp")," and ",o.a.createElement(e.code,null,"class EncLib")," have a protected ",o.a.createElement(e.code,null,"bool m_HashME;"),o.a.createElement(e.br,null),o.a.createElement(u["a"],{language:"cpp"},"\n\nclass EncApp : public EncAppCfg, public AUWriterIf{\nprivate:\n  // class interface\n  EncLib            m_cEncLib;                    ///< encoder class\n  // ...\n}\n\nclass EncLib : public EncCfg{...}\n"),"The ",o.a.createElement(e.code,null,"m_HashME")," in ",o.a.createElement(e.code,null,"m_cEncLib")," will be set to the value of the ",o.a.createElement(e.code,null,"m_HashME"),"in an ",o.a.createElement(e.code,null,"EncApp")," instance.",o.a.createElement(e.br,null),o.a.createElement(u["a"],{language:"cpp"},"\nvoid EncApp::xInitLibCfg(){\n// ...\n#if JVET_M0253_HASH_ME\n  m_cEncLib.setUseHashME( m_HashME );\n#endif\n// ...\n}\n")),o.a.createElement(e.p,null,"When the VTM4.0 encoder starts, the call stack till ",o.a.createElement(e.code,null,"initBlockSizeToIndex()")," is shown below:",o.a.createElement(u["a"],{language:"shell"},"\n1. main encmain.cpp:153\n2. EncApp::encode() EncApp.cpp:660\n3. EncApp::xCreateLib(std::__1::list<UnitBuf<short>*, std::__1::allocator<UnitBuf<short>*> >&) EncApp.cpp:613\n4. EncLib::create() EncLib.cpp:88\n5. TComHash::initBlockSizeToIndex() Hash.cpp:702\n")),o.a.createElement(e.p,null,o.a.createElement(u["a"],{language:"cpp"},"\nvoid TComHash::initBlockSizeToIndex()\n{\n  for (int i = 0; i < 65; i++)\n  {\n    for (int j = 0; j < 65; j++)\n    {\n      m_blockSizeToIndex[i][j] = -1;\n    }\n  }\n\n  m_blockSizeToIndex[8][8] = 0;\n  m_blockSizeToIndex[16][16] = 1;\n  m_blockSizeToIndex[32][32] = 2;\n  m_blockSizeToIndex[64][64] = 3;\n  m_blockSizeToIndex[4][4] = 4;\n  m_blockSizeToIndex[4][8] = 5;\n  m_blockSizeToIndex[8][4] = 6;\n}\n")),o.a.createElement(e.p,null,o.a.createElement(h["a"],{src:"/static/img/initBlockSizeToIdx.png",width:400,title:"void TComHash::initBlockSizeToIndex()"})),o.a.createElement(e.p,null,"The values inside table ",o.a.createElement(e.code,null,"m_blockSizeToIndex[65][65]")," will be used to calculate the hash value in the function below:",o.a.createElement(u["a"],{language:"cpp"},"\nvoid TComHash::addToHashMapByRowWithPrecalData(\n      uint32_t* picHash[2], bool* picIsSame, \n      int picWidth, int picHeight, \n      int width, int height){...}\n")),o.a.createElement(e.h2,null,"Memo"),o.a.createElement(e.ol,null,o.a.createElement(e.li,null,"HBME is only allowed in NEXT profile [1] (Review of profile is available in last section)."),o.a.createElement(e.li,null,"HBME is performed for 4x4, 4x8, 8x4, 8x8, 16x16, 32x32 and 64x64 blocks."),o.a.createElement(e.li,null,"For inter coding, the HBME is performed before all coding modes.")),o.a.createElement(e.h2,null,"Review"),o.a.createElement(e.h3,null,"Profile, Level and Tier"),o.a.createElement(e.p,null,"In this section, the concepts of profile, level and tier in standards are reviewed."),o.a.createElement(e.p,null,"Some variation in capabilities of the standard is necessary to support a broad range of applications. This variation is handled by specifying profiles, levels and tiers."),o.a.createElement(e.p,null,"A ",o.a.createElement(e.strong,null,"profile")," defines the set of coding tools which may be used to encode a video sequence into a bitstream. The encoder is not required to use all coding tools available in the profile but may select the coding tools which it considers to be suitable [2]. A set of allowed profiles in VTM4.0 is shown below."),o.a.createElement(e.p,null,o.a.createElement(u["a"],{language:"cpp"},"\n// Profiles defined in VTM4.0\nnamespace Profile{\n  enum Name {\n    NONE = 0, MAIN = 1, MAIN10 = 2, MAINSTILLPICTURE = 3,\n    MAINREXT = 4, HIGHTHROUGHPUTREXT = 5, NEXT = 6 }; }\n")),o.a.createElement(e.p,null,"A ",o.a.createElement(e.strong,null,"level")," defines the degree of capability given a profile. Levels/degrees of capability are defined to establish the picture resolution, frame rate, bit rate, buffering capacity, and other aspects that are matters of degree rather than basic feature sets/coding tools."),o.a.createElement(e.p,null,o.a.createElement(m,{noteStrToRender:f})),o.a.createElement(e.p,null,"In each level, ",o.a.createElement(e.strong,null,"tiers")," are defined based on the bit rates they are capable of handling. Main Tier is mainly used to meet the demand of consumer usage, while High Tier is used to provide adequate quality for professional usage than what would be necessary for consumer applications. Levels and tiers defined in VTM4.0 are shown below."),o.a.createElement(e.p,null,o.a.createElement(u["a"],{language:"cpp"},"\n// Tiers and Levels defined in VTM4.0\nnamespace Level{\n  enum Tier { MAIN = 0, HIGH = 1, };\n  enum Name {\n    NONE     = 0,   LEVEL1   = 30,  LEVEL2   = 60,  LEVEL2_1 = 63,  LEVEL3   = 90,\n    LEVEL3_1 = 93,  LEVEL4   = 120, LEVEL4_1 = 123, LEVEL5   = 150, LEVEL5_1 = 153,\n    LEVEL5_2 = 156, LEVEL6   = 180, LEVEL6_1 = 183, LEVEL6_2 = 186, LEVEL8_5 = 255, }; }\n")),o.a.createElement(e.hr,null),o.a.createElement(e.p,null,"References"),o.a.createElement(e.p,null,o.a.createElement(d["a"],{num:"1",content:"J. Xu, J. Li, K. Zhang, L. Zhang, H. Liu, Y. Wang, P. Zhao, D. Hong, R. Xiong, 'Non-CE8: Hash-based Motion Search', Joint Video Exploration Team (JVET), docs. JVET-M0253, 2019."})),o.a.createElement(e.p,null,o.a.createElement(d["a"],{num:"2",content:"V. Sze, M. Budagavi, and G. J. Sullivan (Editors), High Efficiency Video Coding (HEVC) Algorithms and Architectures (Integrated Circuits and Systems). Dordrecht: Springer, 2014."})))}))},81:function(e,t,a){"use strict";var n=a(12);var l=a.n(n);var r=a(0);var o=a.n(r);var i=a(20);var s=a.n(i);t["a"]=function(e){var t=e.num,a=e.content;return o.a.createElement("div",{className:"jsx-2207567817 jsx-2207567817 indentRow"},o.a.createElement(s.a,{component:"p",gutterBottom:true},"[",t,"]  "),o.a.createElement(s.a,{component:"p",gutterBottom:true},a),o.a.createElement(l.a,{styleId:"2207567817",css:".indentRow.jsx-2207567817{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}"}))}}},[472]);return{page:e.default}});